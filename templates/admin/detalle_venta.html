<!-- ventas/detalle_venta.html -->
{% extends "base.html" %}

{% block title %}Detalle de Venta #{{ venta.id }} - ServiFarma{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-receipt"></i> Detalle de Venta #{{ venta.id }}</h1>
    <div style="display: flex; gap: 10px;">
        <a href="{{ url_for('visualizar_ventas') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Volver
        </a>
        <button class="btn btn-primary" onclick="window.print()">
            <i class="fas fa-print"></i> Imprimir
        </button>
    </div>
</div>

<!-- Informaci√≥n de la venta - Tarjetas de resumen -->
<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 20px;">
    <div class="stats-card stats-card-primary">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <div class="stats-label">FECHA</div>
                <div class="stats-value" style="font-size: 1.2rem;">
                    {{ venta.fecha_venta.strftime('%d/%m/%Y') if venta.fecha_venta else 'N/A' }}
                </div>
                <small style="opacity: 0.8;">
                    {{ venta.fecha_creacion.strftime('%H:%M:%S') if venta.fecha_creacion else 'N/A' }}
                </small>
            </div>
            <i class="fas fa-calendar-alt stats-icon"></i>
        </div>
    </div>
    
    <div class="stats-card stats-card-success">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <div class="stats-label">VENDEDOR</div>
                <div class="stats-value" style="font-size: 1.2rem;">
                    {{ venta.usuario_nombre or 'N/A' }}
                </div>
                <small style="opacity: 0.8;">{{ venta.usuario_email or '' }}</small>
            </div>
            <i class="fas fa-user-tie stats-icon"></i>
        </div>
    </div>
    
    <div class="stats-card stats-card-warning">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <div class="stats-label">EFECTIVO / CAMBIO</div>
                <div class="stats-value" style="font-size: 1.2rem;">
                    C$ {{ "{:,.2f}".format(venta.efectivo) }}
                </div>
                <small style="opacity: 0.8;">
                    Cambio: C$ {{ "{:,.2f}".format(venta.cambio) }}
                </small>
            </div>
            <i class="fas fa-money-bill-wave stats-icon"></i>
        </div>
    </div>
    
    <div class="stats-card stats-card-info">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <div class="stats-label">TOTAL VENTA</div>
                <div class="stats-value" style="font-size: 1.5rem;">
                    C$ {{ "{:,.2f}".format(venta.total_venta) }}
                </div>
                <small style="opacity: 0.8;">
                    {% if venta.efectivo >= venta.total_venta %}
                        <span class="badge success">Pagado en efectivo</span>
                    {% else %}
                        <span class="badge info">Tarjeta/Transferencia</span>
                    {% endif %}
                </small>
            </div>
            <i class="fas fa-cash-register stats-icon"></i>
        </div>
    </div>
</div>

<!-- Resumen de la venta -->
<div style="margin-bottom: 20px;">
    <div class="alert alert-info" style="margin: 0;">
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
            <div>
                <strong>Total Items:</strong> 
                <span class="badge primary">{{ resumen_detalle.total_items }}</span>
            </div>
            <div>
                <strong>Productos:</strong> 
                <span class="badge primary">{{ resumen_detalle.total_productos }}</span>
            </div>
            <div>
                <strong>Servicios:</strong> 
                <span class="badge success">{{ resumen_detalle.total_servicios }}</span>
            </div>
            <div>
                <strong>Combos:</strong> 
                <span class="badge warning">{{ resumen_detalle.total_combos }}</span>
            </div>
        </div>
        {% if resumen_detalle.items_no_disponibles > 0 %}
        <div style="margin-top: 10px;">
            <span class="badge danger">
                <i class="fas fa-exclamation-triangle"></i>
                {{ resumen_detalle.items_no_disponibles }} items ya no est√°n disponibles en el inventario
            </span>
        </div>
        {% endif %}
    </div>
</div>

<!-- Tabla de detalles -->
<div class="table-container">
    <table class="table">
        <thead>
            <tr>
                <th>#</th>
                <th>Tipo</th>
                <th>Item</th>
                <th>Presentaci√≥n</th>
                <th class="text-right">Cantidad</th>
                <th>Unidad</th>
                <th class="text-right">Precio Unit.</th>
                <th class="text-right">Subtotal</th>
                <th>Estado</th>
            </tr>
        </thead>
        <tbody>
            {% for detalle in detalles %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>
                    {% if detalle.tipo_detalle == 'producto' %}
                        <span class="badge primary">üì¶ Producto</span>
                    {% elif detalle.tipo_detalle == 'servicio' %}
                        <span class="badge success">üíâ Servicio</span>
                    {% elif detalle.tipo_detalle == 'combo' %}
                        <span class="badge warning">üéÅ Combo</span>
                    {% else %}
                        <span class="badge secondary">‚ùì</span>
                    {% endif %}
                </td>
                <td>
                    {{ detalle.nombre_item }}
                    {% if detalle.item_id %}
                        <small style="color: #666;">(ID: {{ detalle.item_id }})</small>
                    {% endif %}
                </td>
                <td>{{ detalle.presentacion or '-' }}</td>
                <td class="text-right">{{ detalle.cantidad }}</td>
                <td>{{ detalle.unidad_abrev or detalle.unidad_nombre or '-' }}</td>
                <td class="text-right">C$ {{ "{:,.2f}".format(detalle.precio_unitario) }}</td>
                <td class="text-right">C$ {{ "{:,.2f}".format(detalle.subtotal) }}</td>
                <td>
                    {% if 'no disponible' in detalle.estado_item.lower() %}
                        <span class="badge danger">{{ detalle.estado_item }}</span>
                    {% else %}
                        <span class="badge success">{{ detalle.estado_item }}</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot style="font-weight: bold; background-color: #f8f9fa;">
            <tr>
                <td colspan="7" class="text-right">TOTAL:</td>
                <td class="text-right" style="color: #28a745; font-weight: bold;">
                    C$ {{ "{:,.2f}".format(resumen_detalle.subtotal) }}
                </td>
                <td></td>
            </tr>
        </tfoot>
    </table>
</div>

<!-- Footer con informaci√≥n de registro -->
<div style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 4px; border-left: 4px solid #0d6efd;">
    <small style="color: #666;">
        <i class="fas fa-info-circle"></i>
        Venta registrada el {{ venta.fecha_creacion.strftime('%d/%m/%Y %H:%M:%S') if venta.fecha_creacion else 'N/A' }}
    </small>
</div>

<style>
/* Estilos para impresi√≥n */
@media print {
    .page-header button,
    .page-header a,
    .btn {
        display: none !important;
    }
    
    .stats-card {
        break-inside: avoid;
        border: 1px solid #ddd !important;
        background: white !important;
        color: #333 !important;
    }
    
    .badge {
        border: 1px solid #000 !important;
        color: #000 !important;
        background: transparent !important;
    }
    
    .table-container {
        border: 1px solid #ddd !important;
    }
}

/* Estilos adicionales para badges en el resumen */
.badge.primary {
    background-color: #cfe2ff;
    color: #084298;
    padding: 4px 8px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: 600;
    margin-left: 5px;
}

.badge.success {
    background-color: #d1e7dd;
    color: #0f5132;
    padding: 4px 8px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: 600;
    margin-left: 5px;
}

.badge.warning {
    background-color: #fff3cd;
    color: #856404;
    padding: 4px 8px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: 600;
    margin-left: 5px;
}

.badge.danger {
    background-color: #f8d7da;
    color: #842029;
    padding: 4px 8px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: 600;
    margin-left: 5px;
}

.badge.info {
    background-color: #cff4fc;
    color: #055160;
    padding: 4px 8px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: 600;
}

.badge.secondary {
    background-color: #e9ecef;
    color: #41464b;
    padding: 4px 8px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: 600;
}

/* Alert personalizado */
.alert-info {
    background-color: #cff4fc;
    border-left: 4px solid #0dcaf0;
    color: #055160;
    padding: 15px 20px;
    border-radius: 4px;
}

/* Responsive */
@media (max-width: 768px) {
    [style*="grid-template-columns: repeat(4, 1fr)"] {
        grid-template-columns: 1fr !important;
    }
    
    .table-container {
        overflow-x: auto;
    }
}
</style>
{% endblock %}